# Load lobster collector site table:
x <- read.csv("data/raw/129_Site_Table.csv", header = TRUE, stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
# Change field names:
str <- names(x)
str
str[str == "site_name"] <- "site"
str
names(x) <- str
str
str[str == "site_name"] <- "site"
names(x) <- str
str
# Define variables to keep in the output:
vars <- c("year", "site", "longitude", "latitude", "date.deployed", "date.retrieved")
# Load lobster collector site table:
x <- read.csv("data/raw/129_Site_Table.csv", header = TRUE, stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
# Change field names:
str <- names(x)
str[str == "site_name"] <- "site"
str[str == "c_enter_lat"] <- "latitude"
str[str == "c_enter_lon"] <- "longitude"
str[str == "comments"] <- "comment"
names(x) <- str
names(x)
# Define variables to keep in the output:
vars <- c("year", "site", "longitude", "latitude", "date.deployed", "date.retrieved")
# Load lobster collector site table:
x <- read.csv("data/raw/129_Site_Table.csv", header = TRUE, stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
names(x)
str <- names(x)
str
str[str == "site_name"] <- "site"
str[str == "c_enter_lat"] <- "latitude"
str[str == "c_enter_lon"] <- "longitude"
str[str == "comments"] <- "comment"
names(x) <- str
str
str
# Define variables to keep in the output:
vars <- c("year", "site", "collector", "condition", "comment")
# Load lobster larvae collector table:
x <- read.csv("https://raw.github.com/TobieSurette/lobster-collectors/master/data/raw/129_Collector_Table_08_18.csv", stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
# Change field names:
str <- names(x)
str[str == "site_name"] <- "site"
str[str == "r_year"] <- "year"
str[str == "coll_no"] <- "collector"
str[str == "ret_comments"] <- "comment"
str[str == "cond_ret"] <- "condition"
names(x) <- str
str
# Define variables to keep in the output:
vars <- c("year", "site", "longitude", "latitude", "date.deployed", "date.retrieved")
# Load lobster collector site table:
x <- read.csv("data/raw/129_Site_Table.csv", header = TRUE, stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
# Change field names:
str <- names(x)
str[str == "site_name"] <- "site"
str[str == "c_enter_lat"] <- "latitude"
str[str == "c_enter_lon"] <- "longitude"
str[str == "comments"] <- "comment"
names(x) <- str
str
# Define variables to keep in the output:
vars <- c("year", "site", "longitude", "latitude", "date.deployed", "date.retrieved")
# Load lobster collector site table:
x <- read.csv("data/raw/129_Site_Table.csv", header = TRUE, stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
# Change field names:
str <- names(x)
str
str[str == "site_name"] <- "site"
str
str[str == "c_enter_lat"] <- "latitude"
str[str == "c_enter_lon"] <- "longitude"
str[str == "comments"] <- "comment"
names(x) <- str
str
# Correct coordinate fields:
x$longitude <- -abs(x$longitude)
x$latitude  <- abs(x$latitude)
x$date.deployed  <- as.character(as.Date(paste0(x$s_year, "-", x$s_month, "-", x$s_day)))
x$date.retrieved <- as.character(as.Date(paste0(x$r_year, "-", x$r_month, "-", x$r_day)))
library(gulf.data)
excel(x)
x$year <- as.numeric(substr(x$date.deployed, 1, 4))
x <- x[vars]
excel(x)
y <- aggregate(x[c("longitude", "latitude")], by = x["site"], mean, na.rm = TRUE)
y
y <- aggregate(x[c("longitude", "latitude","year")], by = x["site"], mean, na.rm = TRUE)
y
y <- aggregate(x[c("longitude", "latitude","year")], by = x["site"], mean, na.rm = TRUE)
y
y <- aggregate(x[c("longitude", "latitude","year")], by = x["site","year"], mean, na.rm = TRUE)
getwd
getwd()
write.table(x, file = "/data/site.csv", col.names = TRUE, row.names = FALSE, sep = ",")
write.table(x, file = "data/site.csv", col.names = TRUE, row.names = FALSE, sep = ",")
vars <- c("year", "site", "longitude", "latitude", "date.deployed", "date.retrieved", "comment")
# Load lobster collector site table:
x <- read.csv("data/raw/129_Site_Table.csv", header = TRUE, stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
# Change field names:
str <- names(x)
str[str == "site_name"] <- "site"
str[str == "c_enter_lat"] <- "latitude"
str[str == "c_enter_lon"] <- "longitude"
str[str == "comments"] <- "comment"
names(x) <- str
# Correct coordinate fields:
x$longitude <- -abs(x$longitude)
x$latitude  <- abs(x$latitude)
# Format date fields:
x$date.deployed  <- as.character(as.Date(paste0(x$s_year, "-", x$s_month, "-", x$s_day)))
x$date.retrieved <- as.character(as.Date(paste0(x$r_year, "-", x$r_month, "-", x$r_day)))
x$year <- as.numeric(substr(x$date.deployed, 1, 4))
# Remove irrelevant fields:
x <- x[vars]
y <- aggregate(x[c("longitude", "latitude")], by = x["site"], mean, na.rm = TRUE)
y$station <- NA
y$depth <- NA
output_dir
write.table(x, file = "data/site.csv", col.names = TRUE, row.names = FALSE, sep = ",")
# Define variables to keep in the output:
vars <- c("year", "site", "collector", "condition", "comment")
# Load lobster larvae collector table:
x <- read.csv("data/raw/129_Collector_Table.csv", header = TRUE, stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
# Change field names:
str <- names(x)
str[str == "site_name"] <- "site"
str[str == "r_year"] <- "year"
str[str == "coll_no"] <- "collector"
str[str == "ret_comments"] <- "comment"
str[str == "cond_ret"] <- "condition"
names(x) <- str
str
x
library(gulf.data)
excel(x)
# Collector condition table:
conditions <- c("OK", "<1/2", ">1/2", "Damaged", "Lost")
x$condition <- conditions[x$condition]
excel(x)
# Remove irrelevant fields:
x <- x[vars]
write.table(x, file = "data/collector.csv", col.names = TRUE, row.names = FALSE, sep = ",")
y <- read.csv("data/raw/129_Crab_Fish_table.csv", stringsAsFactors = FALSE)
names(y) <- tolower(names(y))
y$year <- y$r_year
y$species <- paste(y$genus, y$species)
y$site <- y$site_name
y$collector <- y$coll_no
y$size <- y$length_mm
y$weight <- y$weight_g
y$sex <- toupper(y$sex)
y$sex[y$sex == "2"] <- "F"
y$comment <- y$comments
library(gulf.data)
excel(y)
excel(y)
# Define variables to keep in the output:
vars <- c("year", "site", "collector", "species", "sex", "size", "weight", "comment")
# Load data:
y <- read.csv("data/raw/129_Crab_Fish_table.csv", stringsAsFactors = FALSE)
names(y) <- tolower(names(y))
y$year <- y$r_year
y$species <- paste(y$genus, y$species)
y$site <- y$site_name
y$collector <- y$coll_no
y$size <- y$length_mm
y$weight <- y$weight_g
y$sex <- toupper(y$sex)
y$sex[y$sex == "2"] <- "F"
y$comment <- y$comments
# Remove irrelevant fields:
x <- x[vars]
#
# # Load 2019 data:
# x <- read.csv("https://raw.github.com/TobieSurette/lobster-collectors/master/data/raw/Collector%20Data%202019.csv", stringsAsFactors = FALSE)
# names(x) <- tolower(names(x))
#
# # Create year field:
# x$year <- 2019
#
# # Variable name corrections:
# str <- names(x)
# x$size <- x$size.cl..cw.or.tl
# x$weight <- NA
# x$collector <- x$collector.number
# x$comment  <- x$notes
#
# # Clean up study area field:
# x$study.area <- gsub("\n", "", x$study.area)
#
# # Clean up sex field:
# x$sex <- toupper(x$sex)
#
# # Remove empty observations:
# x <- x[!is.na(x$size) | x$sex != "", ]
# Clean up comments:
#x$comment <- gsub(",", ";", x$comment)
#
# # Combine data sets:
# x <- rbind(x[vars], y[vars])
# Output to file:
# Define variables to keep in the output:
vars <- c("year", "site", "collector", "species", "sex", "size", "weight", "comment")
# Load data:
y <- read.csv("data/raw/129_Crab_Fish_table.csv", stringsAsFactors = FALSE)
names(y) <- tolower(names(y))
y$year <- y$r_year
y$species <- paste(y$genus, y$species)
y$site <- y$site_name
y$collector <- y$coll_no
y$size <- y$length_mm
y$weight <- y$weight_g
y$sex <- toupper(y$sex)
y$sex[y$sex == "2"] <- "F"
y$comment <- y$comments
# Remove irrelevant fields:
y <- y[vars]
#
excel(y)
library(gulf.data)
library(gulf.utils)
library(gulf.spatial)
# Define variables to keep in the output:
vars <- c("year", "site", "collector", "condition", "comment")
# Load lobster larvae collector table:
file <- locate(file = "129_Collector_Table.csv")
file
library(gulf.utils)
library(gulf.spatial)
# Define variables to keep in the output:
vars <- c("year", "site", "collector", "condition", "comment")
# Load lobster larvae collector table:
file <- locate(file = "129_Collector_Table.csv")
x <- read.csv(file, header = TRUE, stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
# Change field names:
str <- names(x)
str[str == "site_name"] <- "site"
str[str == "r_year"] <- "year"
str[str == "coll_no"] <- "collector"
str[str == "ret_comments"] <- "comment"
str[str == "cond_ret"] <- "condition"
names(x) <- str
# Collector condition table:
conditions <- c("OK", "<1/2", ">1/2", "Damaged", "Lost")
x$condition <- conditions[x$condition]
# Remove irrelevant fields:
x <- x[vars]
write.table(x, file = "data/collector.csv", col.names = TRUE, row.names = FALSE, sep = ",")
# x$longitude <- NA
# x$latitude <- NA
# #x$site2 <- ""
# # Load coordinate data:
# files <- locate(file = "Collector_coordinates")
# for (i in 1:4){
#    y <- readLines(files[i])
#    y <- strsplit(y, "\t")
#    n <- unlist(lapply(y, length))
#    t <- table(n)
#    t <- t[as.numeric(names(t)) > 1]
#    t <- as.numeric(names(t[which.max(t)]))
#    y <- y[n == t]
#
#    tmp <- NULL
#    for (j in 1:length(y)) tmp <- rbind(tmp, y[[j]])
#    y <- as.data.frame(tmp, stringsAsFactors = FALSE)
#
#    y <- y[, unlist(lapply(y, function(y) return(length(unique(y)) > 1)))]
#
#    # Identify collector column:
#    j <- which(unlist(lapply(y, function(y) return(all(gsub("[0-9]", "", y) == "")))))
#    names(y) <- gsub(names(y)[j], "collector", names(y))
#    y[, j] <- as.numeric(y[, j])
#
#    # Identify coordinates column:
#    j <- which(unlist(lapply(y, function(y) return(length(grep("^N[0-9][0-9]", y)) > 0))))
#    y[,j] <- gsub("^N", "", y[,j])
#    y[,j] <- gsub(" W", ",", y[,j])
#    y[,j] <- gsub(" ", "", y[,j])
#    y$latitude <- dmm2deg(as.numeric(unlist(lapply(strsplit(y[,j], ","), function(y) y[1]))))
#    y$longitude <- -dmm2deg(as.numeric(unlist(lapply(strsplit(y[,j], ","), function(y) y[2]))))
#
#    # Identify site column:
#    j <- which(unlist(lapply(y, function(y) return(length(grep("albert", tolower(y))) > 0))))
#    names(y) <- gsub(names(y)[j], "site", names(y))
#
#    # Identify date column:
#    j <- which(unlist(lapply(y, function(y) return(length(grep("[0-9]:[0-9][0-9]", y)) >= 0.5  * length(y)))))
#    names(y) <- gsub(names(y)[j], "date", names(y))
#    y$date <- unlist(lapply(strsplit(y$date, " "), function(y) y[1]))
#
#    # Remove irrelvant fields:
#    y <- y[, -grep("^V[0-9]", names(y))]
#
#    # Merge with collector table:
#    ix <- match(y$collector, x$collector)
#    x$longitude[ix[!is.na(ix)]] <- y$longitude[!is.na(ix)]
#    x$latitude[ix[!is.na(ix)]] <- y$latitude[!is.na(ix)]
#    #x$site2[ix[!is.na(ix)]] <- y$site[!is.na(ix)]
# }
#
# # Write to file:
# file <- paste0(strsplit(file, "/raw")[[1]][1], "/collector.csv")
#
# write.table(x, file = file, col.names = TRUE, row.names = FALSE, sep = ",")
# Define variables to keep in the output:
vars <- c("year", "site", "collector", "species", "sex", "size", "weight", "comment")
# Load data:
y <- read.csv("data/raw/129_Crab_Fish_table.csv", stringsAsFactors = FALSE)
names(y) <- tolower(names(y))
y$year <- y$r_year
y$species <- paste(y$genus, y$species)
y$site <- y$site_name
y$collector <- y$coll_no
y$size <- y$length_mm
y$weight <- y$weight_g
y$sex <- toupper(y$sex)
y$sex[y$sex == "2"] <- "F"
y$comment <- y$comments
# Remove irrelevant fields:
y <- y[vars]
#
# # Load 2019 data:
# x <- read.csv("https://raw.github.com/TobieSurette/lobster-collectors/master/data/raw/Collector%20Data%202019.csv", stringsAsFactors = FALSE)
# names(x) <- tolower(names(x))
#
# # Create year field:
# x$year <- 2019
#
# # Variable name corrections:
# str <- names(x)
# x$size <- x$size.cl..cw.or.tl
# x$weight <- NA
# x$collector <- x$collector.number
# x$comment  <- x$notes
#
# # Clean up study area field:
# x$study.area <- gsub("\n", "", x$study.area)
#
# # Clean up sex field:
# x$sex <- toupper(x$sex)
#
# # Remove empty observations:
# x <- x[!is.na(x$size) | x$sex != "", ]
# Clean up comments:
#x$comment <- gsub(",", ";", x$comment)
#
# # Combine data sets:
# x <- rbind(x[vars], y[vars])
# Output to file:
write.table(y, file = "data/biological.csv", col.names = TRUE, row.names = FALSE, sep = ",")
# Define variables to keep in the output:
vars <- c("year", "site", "longitude", "latitude", "date.deployed", "date.retrieved", "comment")
# Load lobster collector site table:
x <- read.csv("data/raw/129_Site_Table.csv", header = TRUE, stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
# Change field names:
str <- names(x)
str[str == "site_name"] <- "site"
str[str == "c_enter_lat"] <- "latitude"
str[str == "c_enter_lon"] <- "longitude"
str[str == "comments"] <- "comment"
names(x) <- str
# Correct coordinate fields:
x$longitude <- -abs(x$longitude)
x$latitude  <- abs(x$latitude)
# Format date fields:
x$date.deployed  <- as.character(as.Date(paste0(x$s_year, "-", x$s_month, "-", x$s_day)))
x$date.retrieved <- as.character(as.Date(paste0(x$r_year, "-", x$r_month, "-", x$r_day)))
x$year <- as.numeric(substr(x$date.deployed, 1, 4))
# Remove irrelevant fields:
x <- x[vars]
y <- aggregate(x[c("longitude", "latitude")], by = x["site"], mean, na.rm = TRUE)
y$station <- NA
y$depth <- NA
output_dir
write.table(x, file = "data/site.csv", col.names = TRUE, row.names = FALSE, sep = ",")
library(gulf.utils)
library(gulf.spatial)
# Define variables to keep in the output:
vars <- c("year", "site", "collector", "condition", "comment")
# Load lobster larvae collector table:
file <- locate(file = "129_Collector_Table.csv")
x <- read.csv(file, header = TRUE, stringsAsFactors = FALSE)
names(x) <- tolower(names(x))
# Change field names:
str <- names(x)
str[str == "site_name"] <- "site"
str[str == "r_year"] <- "year"
str[str == "coll_no"] <- "collector"
str[str == "ret_comments"] <- "comment"
str[str == "cond_ret"] <- "condition"
names(x) <- str
# Collector condition table:
conditions <- c("OK", "<1/2", ">1/2", "Damaged", "Lost")
x$condition <- conditions[x$condition]
# Remove irrelevant fields:
x <- x[vars]
write.table(x, file = "data/collector.csv", col.names = TRUE, row.names = FALSE, sep = ",")
# x$longitude <- NA
# x$latitude <- NA
# #x$site2 <- ""
# # Load coordinate data:
# files <- locate(file = "Collector_coordinates")
# for (i in 1:4){
#    y <- readLines(files[i])
#    y <- strsplit(y, "\t")
#    n <- unlist(lapply(y, length))
#    t <- table(n)
#    t <- t[as.numeric(names(t)) > 1]
#    t <- as.numeric(names(t[which.max(t)]))
#    y <- y[n == t]
#
#    tmp <- NULL
#    for (j in 1:length(y)) tmp <- rbind(tmp, y[[j]])
#    y <- as.data.frame(tmp, stringsAsFactors = FALSE)
#
#    y <- y[, unlist(lapply(y, function(y) return(length(unique(y)) > 1)))]
#
#    # Identify collector column:
#    j <- which(unlist(lapply(y, function(y) return(all(gsub("[0-9]", "", y) == "")))))
#    names(y) <- gsub(names(y)[j], "collector", names(y))
#    y[, j] <- as.numeric(y[, j])
#
#    # Identify coordinates column:
#    j <- which(unlist(lapply(y, function(y) return(length(grep("^N[0-9][0-9]", y)) > 0))))
#    y[,j] <- gsub("^N", "", y[,j])
#    y[,j] <- gsub(" W", ",", y[,j])
#    y[,j] <- gsub(" ", "", y[,j])
#    y$latitude <- dmm2deg(as.numeric(unlist(lapply(strsplit(y[,j], ","), function(y) y[1]))))
#    y$longitude <- -dmm2deg(as.numeric(unlist(lapply(strsplit(y[,j], ","), function(y) y[2]))))
#
#    # Identify site column:
#    j <- which(unlist(lapply(y, function(y) return(length(grep("albert", tolower(y))) > 0))))
#    names(y) <- gsub(names(y)[j], "site", names(y))
#
#    # Identify date column:
#    j <- which(unlist(lapply(y, function(y) return(length(grep("[0-9]:[0-9][0-9]", y)) >= 0.5  * length(y)))))
#    names(y) <- gsub(names(y)[j], "date", names(y))
#    y$date <- unlist(lapply(strsplit(y$date, " "), function(y) y[1]))
#
#    # Remove irrelvant fields:
#    y <- y[, -grep("^V[0-9]", names(y))]
#
#    # Merge with collector table:
#    ix <- match(y$collector, x$collector)
#    x$longitude[ix[!is.na(ix)]] <- y$longitude[!is.na(ix)]
#    x$latitude[ix[!is.na(ix)]] <- y$latitude[!is.na(ix)]
#    #x$site2[ix[!is.na(ix)]] <- y$site[!is.na(ix)]
# }
#
# # Write to file:
# file <- paste0(strsplit(file, "/raw")[[1]][1], "/collector.csv")
#
# write.table(x, file = file, col.names = TRUE, row.names = FALSE, sep = ",")
# Define variables to keep in the output:
vars <- c("year", "site", "collector", "species", "sex", "size", "weight", "comment")
# Load data:
y <- read.csv("data/raw/129_Crab_Fish_table.csv", stringsAsFactors = FALSE)
names(y) <- tolower(names(y))
y$year <- y$r_year
y$species <- paste(y$genus, y$species)
y$site <- y$site_name
y$collector <- y$coll_no
y$size <- y$length_mm
y$weight <- y$weight_g
y$sex <- toupper(y$sex)
y$sex[y$sex == "2"] <- "F"
y$comment <- y$comments
# Remove irrelevant fields:
y <- y[vars]
#
# # Load 2019 data:
# x <- read.csv("https://raw.github.com/TobieSurette/lobster-collectors/master/data/raw/Collector%20Data%202019.csv", stringsAsFactors = FALSE)
# names(x) <- tolower(names(x))
#
# # Create year field:
# x$year <- 2019
#
# # Variable name corrections:
# str <- names(x)
# x$size <- x$size.cl..cw.or.tl
# x$weight <- NA
# x$collector <- x$collector.number
# x$comment  <- x$notes
#
# # Clean up study area field:
# x$study.area <- gsub("\n", "", x$study.area)
#
# # Clean up sex field:
# x$sex <- toupper(x$sex)
#
# # Remove empty observations:
# x <- x[!is.na(x$size) | x$sex != "", ]
# Clean up comments:
#x$comment <- gsub(",", ";", x$comment)
#
# # Combine data sets:
# x <- rbind(x[vars], y[vars])
# Output to file:
write.table(y, file = "data/biological.csv", col.names = TRUE, row.names = FALSE, sep = ",")
